# XSS、CSRF

### XSS(跨站脚本攻击)

**攻击原理**：
攻击者向网页注入恶意脚本（如JavaScript），当用户浏览该页面时，脚本在用户浏览器执行，窃取Cookie、会话信息或篡改页面内容。

**分类**：

1. **反射型XSS**：恶意脚本通过URL参数注入，服务器返回含脚本的页面（如搜索框攻击）页面，触发脚本执行。
2. **存储型XSS**：恶意脚本存储于服务器（如数据库），用户访问时触发（如论坛评论攻击）。
3. **DOM型XSS**：纯前端漏洞，通过修改DOM结构触发（如 `eval()` 或 `innerHTML` 注入）。

**危害**：

* 盗用Cookie、SessionID等身份凭证。
* 劫持用户会话、钓鱼欺诈、传播蠕虫病毒
* 篡改页面内容（如植入恶意广告或跳转链接）

**防御措施**：

* **输入过滤与输出编码**：对用户输入的特殊字符（如`<`、`>`）进行HTML实体转义（如 `<` 转为 `&lt;`）。
* **设置Cookie为** `HttpOnly`：禁止JavaScript访问Cookie，防止被盗。
* **内容安全策略（CSP）**：通过HTTP头 `Content-Security-Policy` 限制脚本来源，仅允许可信域执行代码。
* **避免危险API**：禁用 `eval()`、谨慎使用 `innerHTML`。


### CSRF(跨站请求伪造)

**攻击原理**：
攻击者诱使用户在已登录目标网站（A站）的状态下访问恶意页面（B站），B站伪造用户身份向A站发起请求（如转账、改密），利用浏览器的自动Cookie携带机制完成攻击。

**典型场景**：

* 用户登录银行网站后访问恶意链接，触发隐藏的转账请求。
* 利用`<img src="银行转账URL">`发起GET请求。

**危害**：

* 以用户名义执行敏感操作（转账、改密、发帖）。
* 结合XSS可扩大攻击范围（如窃取Token后伪造请求）。

**防御措施**：

1. **Token验证**：请求中携带随机Token（服务器生成并校验），攻击者无法预测。
2. **验证码**：敏感操作需二次确认（如短信验证码）。
3. **检查Referer/Origin头**：验证请求来源是否合法（但可能被篡改）。
4. **限制敏感操作为POST**：避免通过GET请求修改数据。
5. **使用JWT+无Cookie认证**：前端手动携带Token，避免自动发送Cookie。
6. **SameSite Cookie**：设置`SameSite=Strict`或`SameSite=Lax`，防止CSRF攻击。

### XSS与CSRF的核心区别

| 维度 | XSS | CSRF |
| --- | --- | --- |
| **攻击目标** | 窃取用户数据或控制浏览器 | 冒充用户执行操作 |
| **攻击方式** | 浏览器执行用户输入的代码 | 浏览器向目标网站发送请求 |
| **技术本质** | 注入并执行恶意脚本	| 伪造HTTP请求 |
| **防御核心** | 输入/输出过滤、CSP、HttpOnly | CSRF Token、SameSite、Referer 检查 |

### 总结

**XSS是“脚本注入”**：防御关键在于**隔离不可信内容**（转义、CSP）。

**CSRF是“请求冒充”**：防御核心是**验证请求合法性**（Token、验证码）。